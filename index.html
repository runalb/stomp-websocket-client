<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>STOMP WebSocket Client by Runal Banarse</title>

  <!-- SockJS & STOMP -->
  <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>

  <link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="app-shell">
  <div class="card">
    <div class="card-header">
      <div>
        <h2 class="title">STOMP WebSocket Client</h2>
        <p class="subtitle">Developer: Runal Banarse</a></p>
      </div>
      <div class="badge">
        <span></span>
        <a href="https://runalb.com" target="_blank" class="brand-link">runalb.com</a>
      </div>
    </div>

    <div class="form-grid">
      <div class="field-group">
        <label for="wsUrl" class="field-label">WebSocket URL</label>
        <input
          id="wsUrl"
          class="field-input"
          value="http://localhost:8080/ws"
          placeholder="http://localhost:8080/ws"
        >
      </div>

      <div class="field-group">
        <label for="hotelId" class="field-label">Hotel ID</label>
        <input
          id="hotelId"
          class="field-input"
          value="1"
          placeholder="1"
        >
      </div>

      <div class="field-group" style="grid-column: 1 / -1;">
        <label for="events" class="field-label">Event types (comma separated)</label>
        <input
          id="events"
          class="field-input"
          value="update_kds,update_table,update_order"
          placeholder="update_kds,update_table,update_order"
        >
      </div>

      <div class="button-row" style="grid-column: 1 / -1;">
        <button class="btn btn-primary" onclick="connect()">Connect</button>
        <button class="btn btn-secondary" onclick="disconnect()">Disconnect</button>
      </div>
    </div>

    <div class="log-wrapper">
      <div class="log-label-row">
        <div>Event stream</div>
        <div class="log-meta">Subscribed STOMP topics &amp; messages</div>
      </div>
      <pre id="log"></pre>
    </div>
  </div>
</div>

<script>
  let stompClient = null;

  function log(msg) {
    const el = document.getElementById("log");
    el.textContent += msg + "\n";
    el.scrollTop = el.scrollHeight;
  }

  function connect() {
    const wsUrl = document.getElementById("wsUrl").value;
    const hotelId = document.getElementById("hotelId").value;
    const events = document.getElementById("events").value
                    .split(",")
                    .map(e => e.trim());

    const socket = new SockJS(wsUrl);
    stompClient = Stomp.over(socket);
    stompClient.debug = null; // disable verbose logs

    stompClient.connect({}, () => {
      log(`âœ… Connected: ${wsUrl}`);

      events.forEach(event => {
        const topic = `/topic/hotel.${hotelId}.${event}`;
        stompClient.subscribe(topic, message => {
          log(`ðŸ“© Received message on: ${topic} â†’ ${message.body}`);
        });
        log(`ðŸ”” Subscribed to: ${topic}`);
      });

    }, error => {
      log("âŒ Connection error: " + error);
    });
  }

  function disconnect() {
    if (stompClient) {
      stompClient.disconnect(() => log("ðŸ”Œ Disconnected"));
    }
  }
</script>

</body>
</html>
